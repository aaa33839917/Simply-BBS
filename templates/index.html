{% extends 'base.html' %}

{% block title %}首页{% endblock %}

{% block scripts %}
    <style>
        /* 排名区域样式 */
        .ranking-section {
            background-color: #fafafa;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .ranking-section h2 {
            margin-bottom: 20px;
            color: #34495e;
            font-size: 1.8rem;
        }
        
        .ranking-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .ranking-item {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .ranking-item h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .ranking-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .ranking-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .ranking-list li::before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .ranking-list li a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 0.95rem;
        }
        
        .ranking-list li a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
        
        .ranking-list li:last-child {
            margin-bottom: 0;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .ranking-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <!-- 排名区域 -->
    <section class="ranking-section">
        <h2>快速浏览</h2>
        
        <!-- 综合排名 -->
        <div class="ranking-container">
            <!-- 最新发布 -->
            <div class="ranking-item">
                <h3>最新发布</h3>
                <ul class="ranking-list">
                    {% set sorted_posts = posts|sort(attribute='created_at', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</a></li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- 点赞最多 -->
            <div class="ranking-item">
                <h3>点赞最多</h3>
                <ul class="ranking-list">
                    {% set sorted_posts = posts|sort(attribute='likes', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %} ({{ post.likes }})</a></li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- 浏览最高 -->
            <div class="ranking-item">
                <h3>浏览最高</h3>
                <ul class="ranking-list">
                    {% set sorted_posts = posts|sort(attribute='views', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %} ({{ post.views }})</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
        <!-- 板块排名 -->
        <div class="ranking-container">
            <!-- MC服务器板块 -->
            <div class="ranking-item">
                <h3>MC服务器板块</h3>
                <ul class="ranking-list">
                    {% set filtered_posts = posts|selectattr('board', 'equalto', 'mc_server') %}
                    {% set sorted_posts = filtered_posts|sort(attribute='created_at', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</a></li>
                    {% else %}
                        <li>暂无帖子</li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Python板块 -->
            <div class="ranking-item">
                <h3>Python板块</h3>
                <ul class="ranking-list">
                    {% set filtered_posts = posts|selectattr('board', 'equalto', 'python') %}
                    {% set sorted_posts = filtered_posts|sort(attribute='created_at', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</a></li>
                    {% else %}
                        <li>暂无帖子</li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- MC日常板块 -->
            <div class="ranking-item">
                <h3>MC日常板块</h3>
                <ul class="ranking-list">
                    {% set filtered_posts = posts|selectattr('board', 'equalto', 'mc_daily') %}
                    {% set sorted_posts = filtered_posts|sort(attribute='created_at', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</a></li>
                    {% else %}
                        <li>暂无帖子</li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Linux板块 -->
            <div class="ranking-item">
                <h3>Linux板块</h3>
                <ul class="ranking-list">
                    {% set filtered_posts = posts|selectattr('board', 'equalto', 'linux') %}
                    {% set sorted_posts = filtered_posts|sort(attribute='created_at', reverse=True) %}
                    {% for post in sorted_posts[:5] %}
                        <li><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</a></li>
                    {% else %}
                        <li>暂无帖子</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </section>
    
    <!-- 帖子列表 -->
    <section class="posts-section">
        <div class="posts-header">
            <h2>帖子列表</h2>
            <div class="sort-options">
                <a href="/?sort=newest" {% if request.args.get('sort') == 'newest' or not request.args.get('sort') and not request.args.get('board') %}class="active"{% endif %}>最新发布</a>
                <a href="/?sort=likes" {% if request.args.get('sort') == 'likes' %}class="active"{% endif %}>点赞最多</a>
                <a href="/?sort=views" {% if request.args.get('sort') == 'views' %}class="active"{% endif %}>浏览最高</a>
            </div>
        </div>
        
        <!-- 板块筛选 -->
        <div class="board-filter">
            <h3>板块筛选</h3>
            <div class="board-options">
                <a href="/" {% if not request.args.get('board') %}class="active"{% endif %}>全部板块</a>
                <a href="/?board=general" {% if request.args.get('board') == 'general' %}class="active"{% endif %}>综合板块</a>
                <a href="/?board=mc_server" {% if request.args.get('board') == 'mc_server' %}class="active"{% endif %}>MC服务器板块</a>
                <a href="/?board=python" {% if request.args.get('board') == 'python' %}class="active"{% endif %}>Python板块</a>
                <a href="/?board=mc_daily" {% if request.args.get('board') == 'mc_daily' %}class="active"{% endif %}>MC日常板块</a>
                <a href="/?board=linux" {% if request.args.get('board') == 'linux' %}class="active"{% endif %}>Linux板块</a>
            </div>
        </div>
        <div id="postsList" class="posts-list">
            {% if posts %}
                {% for post in posts %}
                    <article class="post-item">
                        {% if current_role in ['admin', 'reviewer', 'moderator'] %}
                            <span class="post-status {{ post.status }}">
                                {% if post.status == 'pending' %}待审核
                                {% elif post.status == 'approved' %}已通过
                                {% elif post.status == 'rejected' %}已拒绝
                                {% endif %}
                            </span>
                        {% endif %}
                        <h3 class="post-title"><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title }}</a></h3>
                        <div class="post-meta">
                            <span class="post-board">
                                {% if post.board == 'general' %}综合板块{% elif post.board == 'mc_server' %}MC服务器板块{% elif post.board == 'python' %}Python板块{% elif post.board == 'mc_daily' %}MC日常板块{% elif post.board == 'linux' %}Linux板块{% else %}{{ post.board }}{% endif %}
                            </span>
                            <span class="post-author">作者: {{ post.author }}</span>
                            <span class="post-date">{{ post.created_at }}</span>
                            <span class="post-views">浏览: {{ post.views }}</span>
                            <span class="post-likes">点赞: {{ post.likes }}</span>
                        </div>
                        <div class="post-actions">
                            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="read-more">阅读全文</a>
                        </div>
                    </article>
                {% endfor %}
            {% else %}
                <div class="no-posts">还没有帖子，快来发布第一个帖子吧！</div>
            {% endif %}
        </div>
    </section>
    
    <!-- 发帖表单 -->
    <section class="post-form-section">
        <h2>发布新帖子</h2>
        <form id="postForm" class="post-form">
            {% if not session.get('username') %}
                <div class="login-prompt">
                    请先<a href="{{ url_for('login_page') }}">登录</a>后再发布帖子
                </div>
            {% endif %}
            <div class="form-group">
                <label for="title">标题:</label>
                <input type="text" id="title" name="title" required placeholder="请输入帖子标题" {% if not session.get('username') %}disabled{% endif %}>
            </div>
            <div class="form-group">
                <label for="board">板块:</label>
                <select id="board" name="board" {% if not session.get('username') %}disabled{% endif %}>
                    <option value="general">综合板块</option>
                    <option value="mc_server">MC服务器板块</option>
                    <option value="python">Python板块</option>
                    <option value="mc_daily">MC日常板块</option>
                    <option value="linux">Linux板块</option>
                </select>
            </div>
            <div class="form-group">
                <label for="content">内容:</label>
                <textarea id="content" name="content" rows="5" required placeholder="请输入帖子内容" {% if not session.get('username') %}disabled{% endif %}></textarea>
            </div>
            <button type="submit" class="submit-btn" {% if not session.get('username') %}disabled{% endif %}>发布帖子</button>
        </form>
    </section>
{% endblock %}