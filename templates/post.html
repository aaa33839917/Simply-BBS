{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block scripts %}
    <style>
        /* åˆ é™¤å’Œéšè—å¸–å­æŒ‰é’®æ ·å¼ */
        .delete-btn, .hide-btn, .show-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .hide-btn {
            background-color: #f39c12;
            color: white;
        }
        
        .hide-btn:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }
        
        .show-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .show-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
    </style>
{% endblock %}

{% block content %}
    <section class="post-detail-section">
        <article class="post-detail">
            <h2 class="post-title">{{ post.title }}</h2>
            <div class="post-meta">
                <span class="post-author">ä½œè€…: {{ post.author }}</span>
                <span class="post-date">{{ post.created_at }}</span>
                <span class="post-views">æµè§ˆ: {{ post.views }}</span>
                <span class="post-likes">ç‚¹èµ: <span id="like-count">{{ post.likes }}</span></span>
            </div>
            <div class="post-content">
                {{ post.content }}
            </div>
            <div class="post-actions">
                <form action="{{ url_for('like_post', post_id=post.id) }}" method="post" style="display: inline;">
                    {% if session.get('username') in post.liked_by %}
                        <button type="submit" class="like-btn liked">
                            ğŸ‘ å–æ¶ˆç‚¹èµ ({{ post.likes }})
                        </button>
                    {% else %}
                        <button type="submit" class="like-btn">
                            ğŸ‘ ç‚¹èµ ({{ post.likes }})
                        </button>
                    {% endif %}
                </form>
                
                <!-- åˆ é™¤å’Œéšè—å¸–å­æŒ‰é’® - ä»…ç®¡ç†å‘˜ã€å®¡æ ¸å‘˜å’Œç‰ˆä¸»å¯è§ -->
                {% if current_role in ['admin', 'reviewer', 'moderator'] %}
                    <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post" style="display: inline;">
                        <button type="submit" class="delete-btn" onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡å¸–å­å—ï¼Ÿ');">
                            ğŸ—‘ï¸ åˆ é™¤å¸–å­
                        </button>
                    </form>
                    
                    <form action="{{ url_for('hide_post', post_id=post.id) }}" method="post" style="display: inline;">
                        {% if post.status == 'approved' %}
                            <button type="submit" class="hide-btn">
                                ğŸ™ˆ éšè—å¸–å­
                            </button>
                        {% else %}
                            <button type="submit" class="show-btn">
                                ğŸ‘ï¸ æ˜¾ç¤ºå¸–å­
                            </button>
                        {% endif %}
                    </form>
                {% endif %}
            </div>
        </article>
        
        <!-- è¯„è®ºåŒº -->
        <section class="comments-section">
            <h3>è¯„è®º ({{ post.comments|length }})</h3>
            
            <!-- è¯„è®ºè¡¨å• -->
            <form action="{{ url_for('add_comment', post_id=post.id) }}" method="post" class="comment-form">
                {% if not session.get('username') %}
                    <div class="login-prompt">
                        è¯·å…ˆ<a href="{{ url_for('login_page') }}">ç™»å½•</a>åå†å‘è¡¨è¯„è®º
                    </div>
                {% endif %}
                <div class="form-group">
                    <label for="comment-content">å‘è¡¨è¯„è®º:</label>
                    <textarea id="comment-content" name="content" rows="3" required placeholder="è¯·è¾“å…¥è¯„è®ºå†…å®¹" {% if not session.get('username') %}disabled{% endif %}></textarea>
                </div>
                <button type="submit" class="submit-btn" {% if not session.get('username') %}disabled{% endif %}>æäº¤è¯„è®º</button>
            </form>
            
            <!-- è¯„è®ºåˆ—è¡¨ -->
            <div id="commentsList" class="comments-list">
                {% if post.comments %}
                    {% for comment in post.comments %}
                        <div class="comment-item">
                            <div class="comment-header">
                                <span class="comment-author">{{ comment.author }}</span>
                                <span class="comment-date">{{ comment.created_at }}</span>
                            </div>
                            <div class="comment-content">
                                {{ comment.content }}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-comments">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</div>
                {% endif %}
            </div>
        </section>
        
        <a href="{{ url_for('index') }}" class="back-btn">è¿”å›é¦–é¡µ</a>
    </section>
{% endblock %}